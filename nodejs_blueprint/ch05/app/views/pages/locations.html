{% extends 'layout.html' %}
{% block content %}
<div class="section">
    <div class="container">
        <br><br>
        <h1 class="header center teal-text">{{ title }}</h1>
        <div class="row center">
            <h5 class="header col s12 light">Welcome to {{ title }}</h5>
        </div>
        <div class="row">
            <div class="col s12">
                <form action="/nearme" method="POST">
                    <div class="row">
                        <div class="col s12" id="map" style="height:600px; width: 100%; margin-bottom:20px"></div>
                        <br>
                        <h5 class="grey-text center">당신 근처의 매장을 찾으세요</h5>
                        <br>
                        <div class="input-field col s5">
                            <input placeholder="Insert Longitude" name="longitude"
                            id="longitude" type="text" class="validate" value="{{long}}">
                            <label for="longitude">Longitude</label>
                        </div>
                        <div class="input-field col s5">
                            <input placeholder="Insert Latitude" name="latitude"
                            id="latitude" type="text" class="validate" value="{{long}}">
                            <label for="latitude">Latitude</label>
                        </div>
                        <div class="input-field col s2">
                            <select class="browser-default" name="distance" id="distance">
                                <option value="" disabled selected>Distance</option>
                                <option value="2">2km</option>
                                <option value="3">3km</option>
                                <option value="9">9km</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <button class="btn waves-effect waves-light" type="submit" name="action">제출</button>
                    </div>
                </form>
                <br>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
let loadMap = () => {
    // 현재 위도와 경도를 기준으로 지도의 중앙 얻기
    // 이 예제에서는 고정된 지점으로 시뮬레이션됨
    let googlePos = new google.maps.LatLng({{ lat }}, {{ long }});
    // 지도 옵션 설정
    let mapOptions = {
        zoom: 12,
        center: googlePos,
        mapTypeId: google.maps.MapTypeId.ROADMAP
    };
    // HTML div 얻기 위해 변수 설정
    let mapObj = document.getElementById('map');
    let googleMap = new google.maps.Map(mapObj, mapOptions);
    // 지도에 있는 모든 마커 유지 위해 마커 배열 만들기
    let markers = [];
    // location 변수에서 모든 데이터 얻기 위해 스위그 루프 사용
    {% for item in location %}
    // lat long 객체 설정
    let latLng = new google.maps.LatLng({{ item.coordinates[1] }}, {{ item.coordinates[0] }});
    // 마커 만들기
    let marker = new google.maps.Marker({
        map: googleMap,
        position: latLng,
        animation: google.maps.Animation.DROP
    });
    markers.push(marker);
    // 정보창 설정
    let infowindow = new google.maps.InfoWindow();
    // 마커를 클릭하면 정보창을 보여주는 이벤트 리스너 추가
    google.maps.event.addListener(marker, 'click', () => {
        // 스위그 루프로부터 제목을 얻어 사용
        infowindow.setContent('<p>' + "{{ item.title }}" + '</p>');
        infowindow.open(googleMap, this);
    });
    {% endfor %}
};
// 함수 로딩
window.onload = loadMap;
</script>
{% endblock %}